<header class="hdr">
  <!-- DEBUG: Header y√ºklendi -->
  <script>
    if (window.location.hostname === 'localhost' || window.APP?.DEBUG) {
      console.log('Header partial y√ºklendi - Bootstrap:', typeof bootstrap !== 'undefined');
    }

    // Ensure Bootstrap is loaded - load it if not already present
    if (typeof bootstrap === 'undefined') {
      console.log('Loading Bootstrap JS from header...');
      const script = document.createElement('script');
      script.src = 'https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js';
      script.onload = function() {
        console.log('‚úÖ Bootstrap JS loaded successfully from header');
        window.dispatchEvent(new Event('bootstrap-loaded'));
      };
      script.onerror = function() {
        console.error('‚ùå Bootstrap JS failed to load from header');
      };
      document.head.appendChild(script);
    } else {
      console.log('‚úÖ Bootstrap already loaded');
    }
  </script>

  <!-- Ana Navbar -->
  <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
    <div class="container">
      <!-- Logo/Marka -->
      <a class="navbar-brand d-flex align-items-center" href="/">
        <img src="/assets/logo.png" alt="Logo" height="32" class="me-2">
        <span class="fw-bold d-none d-md-inline header-brand-text">
          <span class="header-title-part-1">Eskisini Ver</span>
          <span class="header-title-part-2">Yenisini Al</span>
        </span>
      </a>

      <!-- Mobile Toggle -->
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent">
        <span class="navbar-toggler-icon"></span>
      </button>

      <!-- Navbar Content -->
      <div class="collapse navbar-collapse" id="navbarContent">

        <!-- Desktop Arama -->
        <div class="navbar-nav mx-auto d-none d-lg-flex">
          <form class="search-form d-flex" role="search" id="headerSearchForm">
            <div class="input-group">
              <input
                class="form-control"
                type="search"
                placeholder="Ne arƒ±yorsunuz?"
                id="headerSearchInput"
                autocomplete="off"
                style="width: 300px;"
              >
              <button class="btn btn-primary px-2" type="submit" title="Ara">
                <i class="fas fa-search"></i>
              </button>
            </div>
          </form>
        </div>

        <!-- Kullanƒ±cƒ± Navigasyonu -->
        <div class="navbar-nav ms-auto">
          <!-- Giri≈ü yapmamƒ±≈üken -->
          <div id="guestNav" hidden>
            <a class="nav-link" href="/register.html" title="Kayƒ±t Ol">
              <i class="fas fa-user-plus"></i>
            </a>
            <a class="nav-link" href="/login.html" title="Giri≈ü Yap">
              <i class="fas fa-sign-in-alt"></i>
            </a>
          </div>

          <!-- Giri≈ü yaptƒ±ktan sonra -->
          <div id="userNav" hidden>
            <a class="nav-link" href="/sell.html" title="ƒ∞lan Ver">
              <i class="fas fa-plus-circle text-success"></i>
            </a>
            <a class="nav-link" href="/shop-settings.html" title="Maƒüazam">
              <i class="fas fa-store text-warning"></i>
            </a>
            <a class="nav-link" href="/favorites.html" title="Favoriler">
              <i class="fas fa-heart text-danger"></i>
            </a>
            <a class="nav-link position-relative" href="#" id="notificationBell" title="Bildirimler">
              <i class="fas fa-bell text-info"></i>
              <span class="notification-badge" id="notificationBadge" style="display: none;">0</span>
            </a>
            <a class="nav-link position-relative" href="/cart.html" title="Sepet">
              <i class="fas fa-shopping-cart text-primary"></i>
              <span class="cart-count" data-cart-count style="display: none;">0</span>
            </a>
            
            <!-- Kullanƒ±cƒ± Dropdown -->
            <div class="nav-item dropdown">
              <a class="nav-link dropdown-toggle d-flex align-items-center" href="javascript:void(0)" role="button" data-bs-toggle="dropdown" aria-expanded="false" id="userDropdown">
                <img id="userAvatar" src="/assets/default-avatar.png" alt="Avatar" class="rounded-circle" width="24" height="24">
                <span id="userName" class="d-none d-xl-inline ms-1 small">Kullanƒ±cƒ±</span>
              </a>
              <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                <li><a class="dropdown-item" href="/profile.html">
                  <i class="fas fa-user"></i> Profilim
                </a></li>
                <li><a class="dropdown-item" href="/shop-settings.html">
                  <i class="fas fa-store"></i> Maƒüaza Ayarlarƒ±
                </a></li>
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item" href="/profile.html?tab=orders">
                  <i class="fas fa-shopping-bag"></i> Sipari≈ülerim
                </a></li>
                <li><a class="dropdown-item" href="/profile.html?tab=mylistings">
                  <i class="fas fa-list"></i> ƒ∞lanlarƒ±m
                </a></li>
                <li><a class="dropdown-item" href="/profile.html?tab=trades">
                  <i class="fas fa-exchange-alt"></i> Takas Teklifleri
                </a></li>
                <li><a class="dropdown-item" href="/profile.html?tab=legal">
                  <i class="fas fa-shield-alt"></i> KVKK Haklarƒ±m
                </a></li>
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item" href="/settings.html">
                  <i class="fas fa-cog"></i> Ayarlar
                </a></li>
                <li><a class="dropdown-item text-danger" href="#" id="btnLogout">
                  <i class="fas fa-sign-out-alt"></i> √áƒ±kƒ±≈ü Yap
                </a></li>
              </ul>
            </div>
          </div>

          <!-- Loading state -->
          <div id="navLoading" class="nav-link text-muted" style="display: flex;">
            <i class="fas fa-spinner fa-spin"></i>
          </div>
        </div>
      </div>

      <!-- Mobile Arama (Sadece mobile'da g√∂r√ºn√ºr) -->
      <div class="w-100 mt-3 d-lg-none">
        <form class="d-flex" role="search" id="mobileSearchForm">
          <div class="input-group">
            <input 
              class="form-control" 
              type="search" 
              placeholder="Ne arƒ±yorsunuz?" 
              id="mobileSearchInput"
              autocomplete="off"
            >
            <button class="btn btn-primary" type="submit">
              <i class="fas fa-search"></i> Ara
            </button>
          </div>
        </form>
      </div>
    </div>
  </nav>
  
  <!-- Yasal Uyumluluk Barƒ± -->
  <div class="legal-compliance-bar border-top">
    <div class="container">
      <div class="d-flex justify-content-between align-items-center py-1">
        <div class="d-flex gap-4">
          <a href="/legal/kvkk.html" class="text-decoration-none text-muted small d-flex align-items-center" title="KVKK Gizlilik Y√∂netimi">
            <i class="fas fa-shield-alt me-1"></i> KVKK
          </a>
          <a href="/legal/complaints.html" class="text-decoration-none text-muted small d-flex align-items-center" title="≈ûikayet Sistemi">
            <i class="fas fa-headset me-1"></i> Destek
          </a>
          <a href="/legal/tax-reports.html" class="text-decoration-none text-muted small d-flex align-items-center" title="Vergi Raporlarƒ±">
            <i class="fas fa-calculator me-1"></i> Vergi
          </a>
        </div>
        
        <div class="d-flex align-items-center gap-2">
          <span class="badge bg-success small">‚úÖ KVKK Uyumlu</span>
          <span class="badge bg-primary small">üîí SSL G√ºvenli</span>
          <i class="fas fa-certificate text-warning" title="Yetkilendirilmi≈ü Platform"></i>
        </div>
      </div>
    </div>
  </div>
</header>

<style>
/* Header √∂zel stilleri - Kompakt */
.navbar {
  padding: 0.2rem 0;
}

.navbar-brand {
  font-size: 1rem;
  padding: 0.4rem 0;
}

/* Header Brand Text Gradient Effects */
.header-brand-text {
  font-family: 'Poppins', sans-serif;
  font-weight: 700;
  font-size: 1.1rem;
  letter-spacing: -0.01em;
}

.header-title-part-1 {
  color: #ffd700; /* Fallback color for older browsers */
  background: linear-gradient(135deg, #ffffff 0%, #ffd700 30%, #ff6b35 70%, #ffffff 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  display: inline-block;
  animation: brandGradientShift 4s ease-in-out infinite;
  margin-right: 0.25rem;
  filter: drop-shadow(0 0 5px rgba(255, 215, 0, 0.3));
}

.header-title-part-2 {
  color: #00f5ff; /* Fallback color for older browsers */
  background: linear-gradient(135deg, #ffffff 0%, #00f5ff 30%, #1e90ff 70%, #ffffff 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  display: inline-block;
  animation: brandGradientShift 4s ease-in-out infinite reverse;
  filter: drop-shadow(0 0 5px rgba(0, 245, 255, 0.3));
}

@keyframes brandGradientShift {
  0%, 100% {
    background-size: 200% 200%;
    background-position: left center;
  }
  50% {
    background-size: 200% 200%;
    background-position: right center;
  }
}

.navbar-brand img {
  border-radius: 6px;
}

.search-form .input-group {
  box-shadow: 0 1px 3px rgba(0,0,0,0.1);
  border-radius: 0.375rem;
  overflow: hidden;
  border: 2px solid #dee2e6;
}

.search-form .form-control {
  border: none;
  border-right: 1px solid #dee2e6;
  font-size: 0.9rem;
  border-radius: 0.375rem 0 0 0.375rem;
}

.search-form .form-control:focus {
  box-shadow: none;
  border-color: #dee2e6;
}

.search-form .input-group:focus-within {
  border-color: #667eea;
  box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.search-form .btn {
  border: none;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  padding: 0.375rem 0.75rem;
  border-radius: 0 0.375rem 0.375rem 0;
}

.navbar-nav .nav-link {
  font-weight: 500;
  padding: 0.25rem 0.375rem;
  border-radius: 0.25rem;
  margin: 0 0.1rem;
  transition: all 0.2s ease;
  min-width: 32px;
  text-align: center;
  cursor: pointer;
  position: relative;
  z-index: 1;
}

.navbar-nav .nav-link:hover {
  background-color: rgba(102, 126, 234, 0.1);
  transform: translateY(-1px);
}

.nav-item.dropdown {
  position: relative;
  z-index: 1000;
}

.dropdown-toggle {
  cursor: pointer !important;
  pointer-events: auto !important;
  text-decoration: none !important;
  user-select: none;
}

.dropdown-toggle:hover {
  opacity: 0.8;
}

.dropdown-toggle::after {
  display: inline-block;
  margin-left: 0.255em;
  vertical-align: 0.255em;
  content: "";
  border-top: 0.3em solid;
  border-right: 0.3em solid transparent;
  border-bottom: 0;
  border-left: 0.3em solid transparent;
}

/* Ensure dropdown link doesn't navigate */
a.dropdown-toggle[href="javascript:void(0)"] {
  color: inherit;
  text-decoration: none;
}

a.dropdown-toggle[href="javascript:void(0)"]:hover {
  color: inherit;
  text-decoration: none;
}

.dropdown-menu {
  border: none;
  box-shadow: 0 10px 40px rgba(0,0,0,0.1);
  border-radius: 0.5rem;
  padding: 0.5rem 0;
  z-index: 1050;
  position: absolute;
}

.dropdown-menu.show {
  display: block;
}

.dropdown-item {
  padding: 0.5rem 1rem;
  font-size: 0.9rem;
  cursor: pointer;
}

.dropdown-item:hover {
  background-color: rgba(102, 126, 234, 0.1);
}

.legal-compliance-bar {
  background: #f8f9fa;
  font-size: 0.75rem;
  padding: 0.25rem 0 !important;
}

.legal-compliance-bar a:hover {
  color: #667eea !important;
}

@media (max-width: 991px) {
  .navbar-collapse {
    margin-top: 1rem;
    padding-top: 1rem;
    border-top: 1px solid #dee2e6;
  }
  
  .legal-compliance-bar .d-flex:first-child {
    gap: 1rem !important;
  }
  
  .legal-compliance-bar .badge {
    font-size: 0.7rem;
  }
}
</style>

<script>
// Header JavaScript
(function() {
  'use strict';

  // Arama form i≈ülevleri
  function setupSearchForms() {
    console.log('Setting up search forms...');

    // Desktop arama
    const headerForm = document.getElementById('headerSearchForm');
    const headerInput = document.getElementById('headerSearchInput');

    // Mobile arama
    const mobileForm = document.getElementById('mobileSearchForm');
    const mobileInput = document.getElementById('mobileSearchInput');

    console.log('Found elements:', {
      headerForm: !!headerForm,
      headerInput: !!headerInput,
      mobileForm: !!mobileForm,
      mobileInput: !!mobileInput
    });

    function handleSearch(input) {
      const query = input.value.trim();
      console.log('Header search called with query:', query);
      if (query) {
        const targetUrl = `/search.html?q=${encodeURIComponent(query)}`;
        console.log('Redirecting to:', targetUrl);
        window.location.href = targetUrl;
      } else {
        console.log('Empty search query, not redirecting');
      }
    }

    if (headerForm && headerInput) {
      console.log('Setting up header search form listener');
      headerForm.addEventListener('submit', (e) => {
        console.log('Header search form submitted');
        e.preventDefault();
        handleSearch(headerInput);
      });
    } else {
      console.warn('Header search form or input not found:', { headerForm, headerInput });
    }

    if (mobileForm && mobileInput) {
      console.log('Setting up mobile search form listener');
      mobileForm.addEventListener('submit', (e) => {
        console.log('Mobile search form submitted');
        e.preventDefault();
        handleSearch(mobileInput);
      });
    } else {
      console.warn('Mobile search form or input not found:', { mobileForm, mobileInput });
    }
  }

  // Kullanƒ±cƒ± durumu y√∂netimi
  function updateUserNav(user = null) {
    console.log('updateUserNav called with:', user);

    const guestNav = document.getElementById('guestNav');
    const userNav = document.getElementById('userNav');
    const navLoading = document.getElementById('navLoading');
    const userName = document.getElementById('userName');
    const userAvatar = document.getElementById('userAvatar');

    if (navLoading) navLoading.style.display = 'none';

    if (user && typeof user === 'object') {
      console.log('Showing user nav for:', user);
      // Kullanƒ±cƒ± giri≈ü yapmƒ±≈ü
      if (guestNav) {
        guestNav.hidden = true;
        guestNav.style.display = 'none';
      }
      if (userNav) {
        userNav.hidden = false;
        userNav.style.display = 'flex';
      }

      if (userName) {
        const displayName = user.full_name || user.name || user.username || user.email || 'Kullanƒ±cƒ±';
        console.log('Setting username to:', displayName);
        userName.textContent = displayName;
      }

      if (userAvatar) {
        const avatarSrc = user.avatar_url || user.avatar || '/assets/default-avatar.png';
        console.log('Setting avatar to:', avatarSrc);
        userAvatar.src = avatarSrc;
      }

      // Initialize elements after user nav is shown
      setTimeout(() => {
        // Initialize notification bell click handler
        const notificationBell = document.getElementById('notificationBell');
        if (notificationBell && !notificationBell.dataset.initialized) {
          notificationBell.dataset.initialized = 'true';

          notificationBell.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation(); // Prevent dropdown interference
            console.log('üîî Notification bell clicked - FULLY ENABLED FOR LOCALHOST');

            // Use existing notification system (auto-initialized by notifications.js)
            if (window.NotificationSystem && window.NotificationSystem.toggleNotificationPanel) {
              window.NotificationSystem.toggleNotificationPanel();
            } else {
              console.warn('üîî Notification system not available');
              alert('Bildirim sistemi hen√ºz hazƒ±r deƒüil. L√ºtfen birka√ß saniye bekleyin.');
            }
          });
          console.log('üîî Notification bell click handler initialized');
        }

        // Logout button - manual reliable setup
        const logoutBtn = document.getElementById('btnLogout');
        if (logoutBtn && !logoutBtn.dataset.listenerAdded) {
          logoutBtn.dataset.listenerAdded = 'true';
          logoutBtn.addEventListener('click', function(e) {
            e.preventDefault();
            console.log('Logout clicked');

            fetch(`${window.APP?.API_BASE || ''}/api/auth/logout`, {
              method: 'POST',
              credentials: 'include',
              headers: { 'Accept': 'application/json' }
            }).then(() => {
              window.currentUser = null;
              document.dispatchEvent(new CustomEvent('auth:logout'));
              console.log('üîí Logout successful, redirecting...');
              window.location.href = '/';
            }).catch(err => {
              console.error('Logout error:', err);
              window.location.href = '/'; // Redirect anyway
            });
          });
          console.log('‚úÖ Logout button listener added successfully');
        }

        // Manually initialize Bootstrap dropdown
        const userDropdown = document.getElementById('userDropdown');
        if (userDropdown) {
          console.log('Initializing Bootstrap dropdown manually...');

          // Function to initialize dropdown
          function initializeDropdown() {
            if (typeof bootstrap !== 'undefined' && bootstrap.Dropdown) {
              try {
                // Check if already initialized
                if (!userDropdown.dataset.bsToggle || userDropdown.dataset.dropdownInitialized !== 'true') {
                  new bootstrap.Dropdown(userDropdown);
                  userDropdown.dataset.dropdownInitialized = 'true';
                  console.log('‚úÖ Bootstrap dropdown initialized successfully');
                }
              } catch (error) {
                console.error('‚ùå Error initializing dropdown:', error);
                setupFallbackDropdown();
              }
            } else {
              setupFallbackDropdown();
            }
          }

          // Fallback dropdown handler
          function setupFallbackDropdown() {
            console.warn('‚ö†Ô∏è Using fallback dropdown (Bootstrap not available)');

            // Remove any existing listeners
            if (!userDropdown.dataset.fallbackInitialized) {
              userDropdown.dataset.fallbackInitialized = 'true';

              userDropdown.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                const dropdownMenu = this.nextElementSibling;

                // Close all other dropdowns
                document.querySelectorAll('.dropdown-menu.show').forEach(menu => {
                  if (menu !== dropdownMenu) {
                    menu.classList.remove('show');
                  }
                });

                // Toggle this dropdown
                if (dropdownMenu && dropdownMenu.classList.contains('dropdown-menu')) {
                  dropdownMenu.classList.toggle('show');
                  console.log('Dropdown toggled (fallback method):', dropdownMenu.classList.contains('show'));
                }
              });

              // Close dropdown when clicking outside
              document.addEventListener('click', function(e) {
                if (!userDropdown.contains(e.target)) {
                  const dropdownMenu = userDropdown.nextElementSibling;
                  if (dropdownMenu && dropdownMenu.classList.contains('dropdown-menu')) {
                    dropdownMenu.classList.remove('show');
                  }
                }
              });

              console.log('‚úÖ Fallback dropdown handler installed');
            }
          }

          // Try to initialize immediately
          initializeDropdown();

          // Listen for Bootstrap loaded event
          window.addEventListener('bootstrap-loaded', function() {
            console.log('Bootstrap loaded event received, initializing dropdown...');
            initializeDropdown();
          });

          // If Bootstrap isn't ready, try again after a delay
          if (typeof bootstrap === 'undefined') {
            setTimeout(initializeDropdown, 500);
            setTimeout(initializeDropdown, 1000);
            setTimeout(initializeDropdown, 2000);
          }
        }
      }, 100);
    } else {
      console.log('Showing guest nav');
      // Kullanƒ±cƒ± giri≈ü yapmamƒ±≈ü
      if (userNav) {
        userNav.hidden = true;
        userNav.style.display = 'none';
      }
      if (guestNav) {
        guestNav.hidden = false;
        guestNav.style.display = 'flex';
      }
    }
  }


  // Initialize
  document.addEventListener('DOMContentLoaded', function() {
    console.log('Header DOMContentLoaded fired');

    // Form setup'ƒ±nƒ± biraz geciktir (partial y√ºklenmesi i√ßin)
    setTimeout(() => {
      console.log('Setting up search forms after delay...');
      setupSearchForms();
    }, 200);
  });

  // Also try immediate check if DOM is already ready
  if (document.readyState === 'complete' || document.readyState === 'interactive') {
    console.log('DOM already ready, running setup immediately');
    setTimeout(() => {
      setupSearchForms();
    }, 300);
  }

  // Global fallback - setup forms after partial loading
  window.setupHeaderSearch = function() {
    console.log('Manual header search setup called');
    setupSearchForms();
  };

  // Auth durumu deƒüi≈üirse g√ºncelle
  document.addEventListener('auth:login', function(e) {
    updateUserNav(e.detail.user);
  });

  document.addEventListener('auth:logout', function() {
    updateUserNav(null);
  });

  // Call header.js bootHeader function when dependencies are loaded
  document.addEventListener('dependenciesLoaded', function() {
    console.log('üöÄ Dependencies loaded, calling bootHeader...');

    // Try to call bootHeader with retry
    function tryBootHeader(attempts = 0) {
      if (typeof window.bootHeader === 'function') {
        window.bootHeader();
        console.log('‚úÖ bootHeader called successfully');
      } else if (typeof bootHeader === 'function') {
        bootHeader();
        console.log('‚úÖ bootHeader called successfully (global)');
      } else if (attempts < 3) {
        // Retry after a short delay (header.js might still be loading)
        setTimeout(() => tryBootHeader(attempts + 1), 100);
      } else {
        console.log('‚ÑπÔ∏è bootHeader function not available (this is normal if header.js loads later)');
      }
    }

    tryBootHeader();
  });

  // DIRECT CALL: Try to call bootHeader immediately after a delay
  // This ensures it runs even if dependenciesLoaded event was missed
  setTimeout(() => {
    console.log('üîç Header.html: Direct bootHeader attempt (after 500ms)');
    console.log('üîç Header.html: window.bootHeader type:', typeof window.bootHeader);

    if (typeof window.bootHeader === 'function') {
      console.log('‚úÖ Header.html: Calling bootHeader directly');
      window.bootHeader();
    } else {
      console.warn('‚ö†Ô∏è Header.html: bootHeader still not available after 500ms');

      // Last resort: Try again after 1 second
      setTimeout(() => {
        if (typeof window.bootHeader === 'function') {
          console.log('‚úÖ Header.html: Calling bootHeader (1 second retry)');
          window.bootHeader();
        } else {
          console.error('‚ùå Header.html: bootHeader never became available');
        }
      }, 1000);
    }
  }, 500);

})();
</script>